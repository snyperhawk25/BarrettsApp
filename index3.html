
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">

    <title>Test Skejooler Map Element</title>
    
    <!--Default Google Stylesheet-->
    <style>
      body {
        font-family: Arial, sans-serif;
        font-size: 12px;
      }

      #map-canvas {
        height: 500px;
        width: 600px;
      }

      #visualization {
        height: 400px;
        width: 500px;
      }
    </style>

    <!--Google Maps Script-->
    <script type="text/javascript"
        src="https://maps.google.com/maps/api/js?key=AIzaSyAA4pr6pygT6q-cClvi404Yuvh4AUOeRjk&v=3"></script>

    <!--Initialize script-->
    <script type="text/javascript">
      /*
      Global Script varaibles
      */
      //Google Maps
      var map;
      var layer;
      var circle;
      //Filters
      var cityValue;
      var radiusValue;
      var supportsOnlineValue;
      //Fusion Table
      var tableId = '1vHtd2HTIiWmfZBfunHoRkTvuJoTG8UXabitBsgok';
      var cityColumn = "City";
      var onlineColumn = "OnlineSupport";
      var addressColumn = "Address";
      //City Table //Burnaby Default
      var City = [
        'Any City',
        '100 Mile House',
        'Abbotsford',
        'Burnaby',
        'Kamloops'
      ];
      
      //Coord Table //Burnaby Default
      var Coord = [
        [49.248775, -122.980531], 
        [51.644127, -121.295124],
        [49.050339, -122.304451],
        [49.248775, -122.980531],
        [49.887836, -119.496592], //!@#Change to Kamloops from Kelowna
      ];

/*
      //Coord Table //Coord.city.longitude //DOESNT WORK //ALSO, THERE ARE SYNTAXICAL MISTAKES LIKE KELOWNA INSTEAD OF KAMLOOPS
      var Coord = {
        "Any City" : {latitude: 49.248775, longitude: -122.980531}, //Burnaby Default
        "100 Mile" : {latitude: 51.644127, longitude: -121.295124},
        "Abbotsford" : {latitude: 49.050339, longitude: -122.304451},
        "Burnaby" : {latitude: 49.248775, longitude: -122.980531},
        "Kelowna" : {latitude: 49.887836, longitude: -119.496592},
      };
*/       
      /*

      //Coord Table
      var Coord = [
        "Any City", 49.248775, -122.980531, //Burnaby Default
        "100 Mile", 51.644127, -121.295124,
        "Abbotsford", 49.050339, -122.304451,
        "Burnaby", 49.248775, -122.980531,
        "Kelowna", 49.887836, -119.496592,
      ];

      */



      /*

      //City Table
      var City = {
        'Any City' : 0, //Burnaby Default
        '100 Mile' : 1,
        'Abbotsford' : 2,
        'Burnaby' : 3,
        'Kelowna' : 4,
      };
      //Coord Table
      var Coord = [
        [49.248775, -122.980531], //Burnaby Default
        [51.644127, -121.295124],
        [49.050339, -122.304451],
        [49.248775, -122.980531],
        [49.887836, -119.496592],
      ];

      */






      //BEGINNING TABLE TEST
      console.log("------------------\nBeginning Table Test:\n");
      var city = "100 Mile House"
      console.log("Coordinates for "+city+" are:\n");
      console.log("Latitude: "+Coord[City.indexOf(city)][0]+"\nLogitude: "+Coord[City.indexOf(city)][1]);
      console.log("-------------------------");


      //Function to Fill Form
      function fillForm(data){
        //date is type object.
        document.getElementById("centerName").value = data.Name.value;
        document.getElementById("centerStreetAddress").value = data.Address.value;
        document.getElementById("centerCity").value = data.City.value;
      }


      //Maps Default Initialization method.    
      function initialize() {

        //Create Map. Default Location is Burnaby
        map = new google.maps.Map(document.getElementById('map-canvas'), {
          center: new google.maps.LatLng(49.248775, -122.9805312),
          zoom: 11,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        //Create Layer
        layer = new google.maps.FusionTablesLayer({
          query: {
            select: "'"+cityColumn+"', '"+addressColumn+"', '"+onlineColumn+"'",
            from: tableId,
          },
          map: map,
          styles: [{
            markerOptions: {
              iconName: "orange_blank" //visit: https://fusiontables.google.com/DataSource?docid=1BDnT5U1Spyaes0Nj3DXciJKa_tuu7CzNRXWdVA#map:id=3 //for a list of all styles
            }
          }]
        });

        //Create circle (Burnaby Default)
        circle = new google.maps.Circle({
          center: new google.maps.LatLng(49.248775, -122.980531),
          radius: 2000,
          map: map,
          fillColor: '#FF0000',
          fillOpacity: 0.4,
          strokeOpacity: 0.7,
          strokeWeight: 1,
          strokeColor: '#FF0000',
        });


        //DOM LISTENERS

        //Fill Form Listener
        google.maps.event.addListener(layer, 'click', function(event) {
          //alert("lat:"+ event.latLng.lat()); //from: https://developers.google.com/maps/documentation/javascript/reference?csw=1#FusionTablesMouseEvent
          fillForm(event.row);
        }); 

        //'radius' Listener
        google.maps.event.addDomListener(document.getElementById('radius'),
            'change', function() {
              updateMap();
        });

        //'city' Listener
        google.maps.event.addDomListener(document.getElementById('city'),
            'change', function() {
              updateMap();
        });

        //'supportsOnline' Listener
        google.maps.event.addDomListener(document.getElementById('supportsOnline'),
            'change', function() {
              updateMap();
        });



      }//Initialize






      // Update the query sent to the Fusion Table Layer based on user selection.
      function updateMap() {
        
        //Collect selection values
        cityValue = document.getElementById('city').value;
        radiusValue = document.getElementById('radius').value;
        supportsOnlineValue = document.getElementById('supportsOnline').value;
        var query = "";

        //Set city section of query
        if (cityValue!="Any City") {
          query += "City = '" + cityValue + "' ";
        }

        //Set 'supportsOnline section of query
        if(document.getElementById("supportsOnline").checked){
          if(query.length!=0){
            query+="AND ";
          }
          query += "OnlineSupport = 'Yes' ";
        }

        //Set 'radius section of query, and update label
        /*
        document.getElementById("displayRadius").innerHTML = ""+(radiusValue/1000.0)+" kilometers";
        if(query.length!=0){
            query+="AND ";
        }
        query += "ST_INTERSECTS("+"Address"+", "+"CIRCLE(LATLNG("+Coord[City.indexOf(cityValue)][0]+", "+Coord[City.indexOf(cityValue)][1]+")"+", "+radiusValue+")) "; 
        */

        //Print query to console:
        console.log("Query:"+query+".");



        //Update layer with query
        layer.setOptions({
            query: {
              select: "'"+cityColumn+"', '"+addressColumn+"', '"+onlineColumn+"'",
              from: tableId,
              where: ""+query+""
            }
        });

        //Update circle radius
        //Remove
        circle.setMap(null); //proper way to remove a circle (https://developers.google.com/maps/documentation/javascript/shapes#circles)
        //create new
        circle = new google.maps.Circle({
          center: new google.maps.LatLng(Coord[City.indexOf(cityValue)][0], Coord[City.indexOf(cityValue)][1]),
          radius: parseInt(radiusValue), //parseInt() reqired for variable radius
          map: map,
          fillColor: '#FF0000',
          fillOpacity: 0.4,
          strokeOpacity: 0.7,
          strokeWeight: 1,
          strokeColor: '#FF0000',
        });

        //Print out record of selection
        console.log("Record for: "+cityValue+"\n"+"Latitide: "+Coord[City.indexOf(cityValue)][0]+", Longitude: "+Coord[City.indexOf(cityValue)][1]+".\n");

      }//updateMap

      //Add the window DOM listener to initialize 
      google.maps.event.addDomListener(window, 'load', initialize);
    
    
      //Function to recenter google maps element on the selected city
      function centerOnCity(){
        if(cityValue!="Any City"){
          map.setCenter(new google.maps.LatLng(Coord[City.indexOf(cityValue)][0], Coord[City.indexOf(cityValue)][1]));
          map.setZoom(11);
        }else{
          map.setCenter(new google.maps.LatLng(49.248775, -122.9805312));
          map.setZoom(9);
        }
        //console
        console.log("Re-Center Clicked.");
      }
    
      //Function to clear eleents of the form
      function clearForm(section){
        if(section==1){
          //Invigilation Center Information
          document.getElementById('centerName').value="";
          document.getElementById('centerStreetAddress').value="";
          document.getElementById('centerCity').value="";
          console.log("Sec.1 Invigilation Center Information [cleared]");
        }
        if(section==2){
          //Examinee Information
          document.getElementById('firstName').value="";
          document.getElementById('lastName').value="";
          document.getElementById('phone').value="";
          document.getElementById('email').value="";
          console.log("Sec.2 Examinee Information [cleared]");
        }
        if(section==3){
          //Institution Information
          console.log("Sec.3 Institution Information [cleared]");
        }
        if(section==4){
          //Exam Information
          console.log("Sec.4 Exam Information [cleared]");
        }
      }//clear
    
    
    
    </script>
  </head>






<!--/////////////////////////////////////////////////////////////////////////////-->







  <body>

    <h1>Skejooler Center Map</h1>
    
    <p><a href="index2.html">Click here to go back to index2</a></p>
    
    <!--Map Element-->
    <hr>
    <div id="map-canvas"></div>
    <hr>

    <h3>Filter Criteria:</h3>
    <!--City Selection-->
    <label>City:</label>
    <select id="city">
      <!--default-->
      <option value="Any City">Any City</option>
      <!--cities-->
      <option value="100 Mile House">100 Mile House</option>
      <option value="Abbotsford">Abbotsford</option>
      <option value="Burnaby">Burnaby</option>
      <option value="Kamloops">Kamloops</option>
    </select>
    <button id="centerButton" type="button" onclick="centerOnCity();">Center To City</button>
    
    <!--Radius Selection, Range, meters(m)-->
    <br>
    <label>Radius:</label>
    <input id='radius' type='Range' min='1000' max='20000' step='100' value='3000'/>
    <label id='displayRadius'></label>

    <!--Online Exams Checkbox-->
    <br>
    <label>Can Support An Online Exam:</label>
    <input id='supportsOnline' type='checkbox' name='supportsOnline'/>



    <!--Form Elements (Don't forget to add required)-->
    <br>
    <hr>
    <br>
    <form>
      <fieldset>
        <legend>Invigilation Center Information</legend>
        <button id="clear1" type="button" onclick="clearForm(1);">Clear Section</button>
        <br>

        <label>Center Name:</label>
        <input id="centerName" type="text" placeholder="Center Name" maxlength="150" size="75"><br>
        <label>Center Street Address:</label>
        <input id="centerStreetAddress" type="text" placeholder="Center Street Address" maxlength="150" size="75"><br>
        <label>Center City:</label>
        <input id="centerCity" type="text" placeholder="Center City" maxlength="150" size="75"><br>
        <label>Center Province:</label>
        <select id="centerProvince">
          <option value="British_Columbia">British Columbia</option>
          <option value="Alberta">Alberta</option>
          <option value="Sasketchewan">Sasketchewan</option>
          <option value="Manitoba">Manitoba</option>
          <option value="Ontario">Ontario</option>
          <option value="Quebec">Quebec</option>
          <option value="Nova_Scotia">Nova Scotia</option>
          <option value="Newfoundland_and_Labrador">Newfoundland and Labrador</option>
          <option value="New_Brunswick">New Brunswick</option>
          <option value="Prince_Edward_Island">Prince Edward Island</option>
          <option value="Yukon">Yukon</option>
          <option value="Northwest_Territories">Northwest Territories</option>
          <option value="Nunavut">Nunavut</option>
        </select>
      </fieldset>

      <fieldset>
        <legend>Examinee Information</legend>
        <button id="clear2" type="button" onclick="clearForm(2);">Clear Section</button>
        <br>

        <label>First Name:</label>
        <input id="firstName" type="text" placeholder="First Name" maxlength="25"><br>
        <label>Last Name:</label>
        <input id="lastName" type="text" placeholder="Last Name" maxlength="25"><br>
        <label>Phone:</label>
        <input id="phone" type="text" placeholder="First Name" maxlength="25"><br>
        <label>Email:</label>
        <input id="email" type="text" placeholder="First Name" maxlength="40"><br>
        <label>Exam Date (First Choice):</label>
        <br>
        <label>Exam Date (Second Choice):</label>
        <br>
        <label>Exam Time (Preferred):</label>
        <br>
      </fieldset>

      <fieldset>
        <legend>Institutional Information</legend>
        <button id="clear3" type="button" onclick="clearForm(3);">Clear Section</button>
        <br>

        <label>School Name:</label>
        <br>
        <label>Street Address:</label>
        <br>
        <label>City:</label>
        <br>
        <label>Province:</label>
        <br>
        <label>Contact Name:</label>
        <br>
        <label>Contact Email:</label>
        <br>
      </fieldset>

      <fieldset>
        <legend>Exam Information</legend>
        <button id="clear4" type="button" onclick="clearForm(4);">Clear Section</button>
        <br>

        <label>Course Number:</label>
        <br>
        <label>Midterm or Final:</label>
        <br>
        <label>Exam Type:</label>
        <br>
        <label>Computer Required?:</label>
        <br>
        <label>Additional Requirements or Information:</label>
        <br>
        <label>Invigilation Fee Covered by Institution:</label>
        <br>
      </fieldset>

      <br>
      <input type="submit" value='Submit Form'>

    </form>


  </body>
</html>