
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">

    <title>Test Skejooler Map Element</title>
    
    <!--Default Google Stylesheet-->
    <style>
      body {
        font-family: Arial, sans-serif;
        font-size: 12px;
      }

      #map-canvas {
        height: 500px;
        width: 600px;
      }

      #visualization {
        height: 400px;
        width: 500px;
      }
    </style>

    <!--Google Maps Script-->
    <script type="text/javascript"
        src="https://maps.google.com/maps/api/js?key=AIzaSyAA4pr6pygT6q-cClvi404Yuvh4AUOeRjk&v=3"></script>

    <!--Initialize script-->
    <script type="text/javascript">
      /*
      Global Script varaibles
      */
      //Google Maps
      var map;
      var layer;
      var circle;
      //Fusion Table
      var tableId = '1vHtd2HTIiWmfZBfunHoRkTvuJoTG8UXabitBsgok';
      var cityColumn = "City";
      var onlineColumn = "OnlineSupport";
      var addressColumn = "Address";
      //City Table //Burnaby Default
      var City = [
        'Any City',
        '100 Mile House',
        'Abbotsford',
        'Burnaby',
        'Kamloops'
      ];
      
      //Coord Table //Burnaby Default
      var Coord = [
        [49.248775, -122.980531], 
        [51.644127, -121.295124],
        [49.050339, -122.304451],
        [49.248775, -122.980531],
        [49.887836, -119.496592],
      ];

/*
      //Coord Table //Coord.city.longitude //DOESNT WORK //ALSO, THERE ARE SYNTAXICAL MISTAKES LIKE KELOWNA INSTEAD OF KAMLOOPS
      var Coord = {
        "Any City" : {latitude: 49.248775, longitude: -122.980531}, //Burnaby Default
        "100 Mile" : {latitude: 51.644127, longitude: -121.295124},
        "Abbotsford" : {latitude: 49.050339, longitude: -122.304451},
        "Burnaby" : {latitude: 49.248775, longitude: -122.980531},
        "Kelowna" : {latitude: 49.887836, longitude: -119.496592},
      };
*/       
      /*

      //Coord Table
      var Coord = [
        "Any City", 49.248775, -122.980531, //Burnaby Default
        "100 Mile", 51.644127, -121.295124,
        "Abbotsford", 49.050339, -122.304451,
        "Burnaby", 49.248775, -122.980531,
        "Kelowna", 49.887836, -119.496592,
      ];

      */



      /*

      //City Table
      var City = {
        'Any City' : 0, //Burnaby Default
        '100 Mile' : 1,
        'Abbotsford' : 2,
        'Burnaby' : 3,
        'Kelowna' : 4,
      };
      //Coord Table
      var Coord = [
        [49.248775, -122.980531], //Burnaby Default
        [51.644127, -121.295124],
        [49.050339, -122.304451],
        [49.248775, -122.980531],
        [49.887836, -119.496592],
      ];

      */






      //BEGINNING TABLE TEST
      console.log("------------------\nBeginning Table Test:\n");
      var city = "100 Mile House"
      console.log("Coordinates for "+city+" are:\n");
      console.log("Latitude: "+Coord[City.indexOf(city)][0]+"\nLogitude: "+Coord[City.indexOf(city)][1]);
      console.log("-------------------------");





      //Maps Default Initialization method.    
      function initialize() {

        //Create Map. Default Location is Burnaby
        map = new google.maps.Map(document.getElementById('map-canvas'), {
          center: new google.maps.LatLng(49.248775, -122.9805312),
          zoom: 11,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        //Create Layer
        layer = new google.maps.FusionTablesLayer({
          query: {
            select: "'"+cityColumn+"', '"+addressColumn+"', '"+onlineColumn+"'",
            from: tableId,
          },
          map: map
        });

        //Create circle (Burnaby Default)
        circle = new google.maps.Circle({
          center: new google.maps.LatLng(49.248775, -122.980531),
          radius: 2000,
          map: map,
          fillColor: '#FF0000',
          fillOpacity: 0.4,
          strokeOpacity: 0.7,
          strokeWeight: 1,
          strokeColor: '#FF0000',
        });

        //'radius' Listener
        google.maps.event.addDomListener(document.getElementById('radius'),
            'change', function() {
              updateMap();
        });

        //'city' Listener
        google.maps.event.addDomListener(document.getElementById('city'),
            'change', function() {
              updateMap();
        });

        //'supportsOnline' Listener
        google.maps.event.addDomListener(document.getElementById('supportsOnline'),
            'change', function() {
              updateMap();
        });


      }//Initialize






      // Update the query sent to the Fusion Table Layer based on user selection.
      function updateMap() {
        
        //Collect selection values
        var cityValue = document.getElementById('city').value;
        var radiusValue = document.getElementById('radius').value;
        var supportsOnlineValue = document.getElementById('supportsOnline').value;
        var query = "";
        
        //Initial radiusValue NaN
        //if(isNaN(radiusValue)){
        //  console.log("RadiusValue is not a number.");
        //  radiusValue=10;
        //}

        //Set city section of query
        if (cityValue!="Any City") {
          query += "City = '" + cityValue + "' ";
        }

        //Set 'supportsOnline section of query
        if(document.getElementById("supportsOnline").checked){
          if(query.length!=0){
            query+="AND ";
          }
          query += "OnlineSupport = 'Yes' ";
        }

        //Set 'radius section of query, and update label
        document.getElementById("displayRadius").innerHTML = ""+(radiusValue/1000.0)+" kilometers";
        if(query.length!=0){
            query+="AND ";
        }
        query += "ST_INTERSECTS("+"Address"+", "+"CIRCLE(LATLNG("+Coord[City.indexOf(cityValue)][0]+", "+Coord[City.indexOf(cityValue)][1]+")"+", "+radiusValue+")) "; 
        

        //Print query to console:
        console.log("Query:"+query+".");



        //Update layer with query
        layer.setOptions({
            query: {
              select: "'"+cityColumn+"', '"+addressColumn+"', '"+onlineColumn+"'",
              from: tableId,
              where: ""+query+""
            }
        });

        //Update circle radius
        //circle.setRadius(radiusValue); //not valid update method
        //!@#Changing circle reset method
        /*
        circle.setOptions({
          center: new google.maps.LatLng(Coord[City.indexOf(cityValue)][0], Coord[City.indexOf(cityValue)][1]),
          radius: radiusValue,
          map: map,
          fillOpacity: 0.4,
          strokeOpacity: 0.7,
          strokeWeight: 1
        });
        */
        //Remove Circle
        circle.setMap(null); //proper way to remove a circle (https://developers.google.com/maps/documentation/javascript/shapes#circles)
        //create new circle
        circle = new google.maps.Circle({
          center: new google.maps.LatLng(Coord[City.indexOf(cityValue)][0], Coord[City.indexOf(cityValue)][1]),
          radius: parseInt(radiusValue), //parseInt() reqired for variable radius
          map: map,
          fillColor: '#FF0000',
          fillOpacity: 0.4,
          strokeOpacity: 0.7,
          strokeWeight: 1,
          strokeColor: '#FF0000',
        });

        //Print out record of selection
        console.log("Record for: "+cityValue+"\n"+"Latitide: "+Coord[City.indexOf(cityValue)][0]+", Longitude: "+Coord[City.indexOf(cityValue)][1]+".\n");

      }//updateMap

      //Add the window DOM listener to initialize 
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>






<!--/////////////////////////////////////////////////////////////////////////////-->







  <body>

    <h1>Skejooler Center Map</h1>
    
    <p><a href="index2.html">Click here to go back to index2</a></p>
    
    <!--Map Element-->
    <div id="map-canvas"></div>
    

    <!--City Selection-->
    <label>City:</label>
    <select id="city">
      <!--default-->
      <option value="Any City">Any City</option>
      <!--cities-->
      <option value="100 Mile House">100 Mile House</option>
      <option value="Abbotsford">Abbotsford</option>
      <option value="Burnaby">Burnaby</option>
      <option value="Kamloops">Kamloops</option>
    </select>
    
    <!--Radius Selection, Range, meters(m)-->
    <br>
    <label>Radius:</label>
    <input id='radius' type='Range' min='1000' max='20000' step='100' value='3000'/>
    <label id='displayRadius'></label>

    <!--Radius Selection, Range-->
    <br>
    <label>Can Support An Online Exam:</label>
    <input id='supportsOnline' type='checkbox' name='supportsOnline'/>
  </body>
</html>