
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">

    <title>Test Skejooler Map Element</title>
    
    <!--Default Google Stylesheet-->
    <style>
      body {
        font-family: Arial, sans-serif;
        font-size: 12px;
      }

      #map-canvas {
        height: 500px;
        width: 600px;
      }

      #visualization {
        height: 400px;
        width: 500px;
      }
    </style>

    <!--Google Maps Script-->
    <script type="text/javascript"
        src="https://maps.google.com/maps/api/js?key=AIzaSyAA4pr6pygT6q-cClvi404Yuvh4AUOeRjk&v=3"></script>

    <!--Initialize script-->
    <script type="text/javascript">

      //Global Script varaibles
      //Google Maps
      var map;
      var layer;
      var circle;
      //Fusion Table
      var tableId = '1vHtd2HTIiWmfZBfunHoRkTvuJoTG8UXabitBsgok';
      var cityColumn = "City";
      var onlineColumn = "OnlineSupport";
      var addressColumn = "Address";
      //City Coordinate Table
      var City = {
        'Default' : [49.887836, -119.496592], //Kelowna Default
        '100 Mile' : [51.644127, -121.295124],
        'Abbotsford' : [49.050339, -122.304451],
        'Burnaby' : [49.248775, -122.980531],
        'Kelowna' : [49.887836, -119.496592], //!@# ctd here
      };
      //City.name[0] - Lat
      //City.name[0] - Lng
      



      //Maps Default Initialization method.    
      function initialize() {

        //Create Map. Default Location is Kelowna
        map = new google.maps.Map(document.getElementById('map-canvas'), {
          center: new google.maps.LatLng(49.887836, -119.496592),
          zoom: 7,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        //Create Layer
        layer = new google.maps.FusionTablesLayer({
          query: {
            select: cityColumn,
            from: tableId
          },
          map: map
        });

        //Create circle
        circle = new google.maps.Circle({
          center: new google.maps.LatLng(49.887836, -119.496592),
          radius: 200, //default 200
          map: map,
          fillOpacity: 0.4,
          strokeOpacity: 0.7,
          strokeWeight: 1
        });

        //'radius' Listener
        google.maps.event.addDomListener(document.getElementById('radius'),
            'change', function() {
              updateMap();
        });

        //'city' Listener
        google.maps.event.addDomListener(document.getElementById('city'),
            'change', function() {
              updateMap();
        });

        //'supportsOnline' Listener
        google.maps.event.addDomListener(document.getElementById('supportsOnline'),
            'change', function() {
              updateMap();
        });


      }//Initialize






      // Update the query sent to the Fusion Table Layer based on user selection.
      function updateMap() {
        
        //Collect selection values
        var cityValue = document.getElementById('city').value;
        var radiusValue = document.getElementById('radius').value;
        var supportsOnlineValue = document.getElementById('supportsOnline').value;
        var query = "";
        
        //Initial radiusValue NaN
        //if(isNaN(radiusValue)){
        //  console.log("RadiusValue is not a number.");
        //  radiusValue=10;
        //}

        //Set city section of query
        if (cityValue!="Any City") {
          query += "City = '" + cityValue + "' ";
        }

        //Set 'supportsOnline section of query
        if(document.getElementById("supportsOnline").checked){
          if(query.length!=0){
            query+="AND ";
          }
          query += "OnlineSupport = 'Yes' ";
        }

        //Set 'radius section of query, and update label
        //!@#THIS NEEDS TO BE FIXED
        document.getElementById("displayRadius").innerHTML = radiusValue;
        if(query.length!=0){
        //    query+="AND ";
        }        
        //query += "ST_INTERSECTS("+"Address"+", "+"CIRCLE(LATLNG(49.887836, -119.496592)"+", "+radiusValue+")) ";                  
        

        


        //Print query to console:
        console.log("Query:"+query+".");



        //Update layer with query
        layer.setOptions({
            query: {
              select: ""+cityColumn+", "+onlineColumn+", "+addressColumn,
              from: tableId,
              where: ""+query+""
            }
        });

        //Update circle radius
        circle.setRadius(radiusValue);

        //Print out record of selection
        console.log("Record for: "+cityValue+"\n"+"Latitide: "+City[cityValue][0]+", Longitude: "+City[cityValue][1]+".\n");

      }//updateMap

      //Add the window DOM listener to initialize 
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>

  <body>

    <h1>Skejooler Center Map</h1>
    
    <p><a href="index2.html">Click here to go back to index2</a></p>
    
    <!--Map Element-->
    <div id="map-canvas"></div>
    

    <!--City Selection-->
    <label>City:</label>
    <select id="city">
      <!--default-->
      <option value="Any City">Any City</option>
      <!--cities-->
      <option value="100 Mile House">100 Mile House</option>
      <option value="Abbotsford">Abbotsford</option>
      <option value="Burnaby">Burnaby</option>
      <option value="Kamloops">Kamloops</option>
    </select>
    
    <!--Radius Selection, Range-->
    <br>
    <label>Radius:</label>
    <input id='radius' type='Range' min='0' max='1000' step='10' value='100'/>
    <label id='displayRadius'></label>

    <!--Radius Selection, Range-->
    <br>
    <label>Can Support An Online Exam:</label>
    <input id='supportsOnline' type='checkbox' name='supportsOnline'/>
  </body>
</html>